# Main site configuration
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name honeybun.local;
    
    # Enable debug logging
    error_log /var/log/nginx/debug.log debug;
    
    # Root directory path - updated to point to your landing page directory
    root /home/jordan/nginx/config/html;
    
    # Root path with more verbose options
    location = / {
        # Try the dashboard, then try index.html in the current dir, then fallback
        try_files $uri/honeybun/index.html honeybun/index.html $uri/index.html @root_fallback;
    }
    
    # Debug endpoint to check paths
    location = /debug {
        add_header Content-Type text/plain;
        return 200 "Document Root: $document_root\nURI: $uri\nFull Path: $document_root$uri\nExists: ${document_root}/honeybun/index.html";
    }
    
    # Health check endpoint
    location = /health {
        try_files honeybun/health/health.html honeybun/health/index.html =200;
        add_header Content-Type text/html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
    }
    
    # Alternative health check endpoint
    location = /health-check-ping {
        try_files honeybun/health/ping.html =200;
        add_header Content-Type text/html;
    }
    
    # Fallback for root
    location @root_fallback {
        add_header Content-Type text/html;
        return 200 "<html><body><h1>Welcome to Honeybun</h1><p>Your Nginx proxy is working!</p></body></html>";
    }
    
    # Other paths
    location / {
        try_files $uri $uri/ @error_handler;
    }
    
    # Error handler
    location @error_handler {
        try_files honeybun/errors/404.html @default_error;
        add_header Content-Type text/html;
    }
    
    # Default error response if error file is missing
    location @default_error {
        add_header Content-Type text/html;
        return 404 "<html><body><h1>Not Found</h1><p>The requested page could not be found.</p></body></html>";
    }
}