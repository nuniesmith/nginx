# Global settings
server_tokens off;
client_max_body_size 100M;

# Include common proxy parameters
include /etc/nginx/proxy_params.conf;

# Main site
server {
    listen 80;
    listen [::]:80;
    server_name honeybun.local;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    
    # Root directory for the landing page
    root /var/www/html/honeybun;
    index index.html;
    
    # Serve the landing page
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    location = /404.html {
        root /var/www/html/honeybun;
    }
    location = /50x.html {
        root /var/www/html/honeybun;
    }
}

# ------------------------------------------------
# Sullivan server services (100.68.132.111)
# ------------------------------------------------

# Emby
server {
    listen 80;
    listen [::]:80;
    server_name emby.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8096;
        include /etc/nginx/proxy_params.conf;
    }
}

# Jellyfin
server {
    listen 80;
    listen [::]:80;
    server_name jellyfin.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8099;
        include /etc/nginx/proxy_params.conf;
    }
}

# Plex
server {
    listen 80;
    listen [::]:80;
    server_name plex.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:32400;
        include /etc/nginx/proxy_params.conf;
    }
}

# ----------- ARR STACK -----------

# Sonarr
server {
    listen 80;
    listen [::]:80;
    server_name sonarr.honeybun.local;
    
    location / {
        # Admin interfaces could benefit from basic auth or IP restrictions
        # add these if/when you want enhanced security
        proxy_pass http://100.68.132.111:8989;
        include /etc/nginx/proxy_params.conf;
    }
}

# Radarr
server {
    listen 80;
    listen [::]:80;
    server_name radarr.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:7878;
        include /etc/nginx/proxy_params.conf;
    }
}

# Lidarr
server {
    listen 80;
    listen [::]:80;
    server_name lidarr.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8686;
        include /etc/nginx/proxy_params.conf;
    }
}

# Readarr Audio
server {
    listen 80;
    listen [::]:80;
    server_name audiobooks.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8787;
        include /etc/nginx/proxy_params.conf;
    }
}

# Readarr Ebooks
server {
    listen 80;
    listen [::]:80;
    server_name ebooks.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8585;
        include /etc/nginx/proxy_params.conf;
    }
}

# Prowlarr
server {
    listen 80;
    listen [::]:80;
    server_name prowlarr.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:9696;
        include /etc/nginx/proxy_params.conf;
    }
}

# Jackett
server {
    listen 80;
    listen [::]:80;
    server_name jackett.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:9117;
        include /etc/nginx/proxy_params.conf;
    }
}

# ----------- BOOK SERVICES -----------

# Audiobookshelf
server {
    listen 80;
    listen [::]:80;
    server_name abs.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:13378;
        include /etc/nginx/proxy_params.conf;
    }
}

# Calibre
server {
    listen 80;
    listen [::]:80;
    server_name calibre.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8082;
        include /etc/nginx/proxy_params.conf;
    }
}

# Calibre Web
server {
    listen 80;
    listen [::]:80;
    server_name calibreweb.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8084;
        include /etc/nginx/proxy_params.conf;
    }
}

# ----------- UTILITY SERVICES -----------

# qBittorrent
server {
    listen 80;
    listen [::]:80;
    server_name qbt.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8080;
        include /etc/nginx/proxy_params.conf;
    }
}

# FileBot
server {
    listen 80;
    listen [::]:80;
    server_name filebot.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:5452;
        include /etc/nginx/proxy_params.conf;
    }
}

# Duplicati
server {
    listen 80;
    listen [::]:80;
    server_name duplicati.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8200;
        include /etc/nginx/proxy_params.conf;
    }
}

# YouTube-DL
server {
    listen 80;
    listen [::]:80;
    server_name youtube.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8998;
        include /etc/nginx/proxy_params.conf;
    }
}

# ------------------------------------------------
# Freddy server services (100.80.111.57)
# ------------------------------------------------

# Wiki
server {
    listen 80;
    listen [::]:80;
    server_name wiki.honeybun.local;
    
    location / {
        proxy_pass http://100.80.111.57:3000;
        include /etc/nginx/proxy_params.conf;
    }
}

# Home Assistant
server {
    listen 80;
    listen [::]:80;
    server_name home.honeybun.local;
    
    # Home Assistant needs longer timeouts
    location / {
        proxy_pass http://100.80.111.57:8123;
        include /etc/nginx/proxy_params.conf;
        proxy_read_timeout 600s;  # Longer timeout for Home Assistant
    }
}

# ------------------------------------------------
# Syncthing instances
# ------------------------------------------------

# Syncthing - Freddy
server {
    listen 80;
    listen [::]:80;
    server_name sync-freddy.honeybun.local;
    
    location / {
        proxy_pass http://100.80.111.57:8385;
        include /etc/nginx/proxy_params.conf;
    }
}

# Syncthing - Sullivan
server {
    listen 80;
    listen [::]:80;
    server_name sync-sullivan.honeybun.local;
    
    location / {
        proxy_pass http://100.68.132.111:8384;
        include /etc/nginx/proxy_params.conf;
    }
}

# Syncthing - Desktop
server {
    listen 80;
    listen [::]:80;
    server_name sync-desktop.honeybun.local;
    
    location / {
        proxy_pass http://100.82.156.41:8384;
        include /etc/nginx/proxy_params.conf;
    }
}

# Syncthing - Oryx
server {
    listen 80;
    listen [::]:80;
    server_name sync-oryx.honeybun.local;
    
    location / {
        proxy_pass http://100.115.54.104:8384;
        include /etc/nginx/proxy_params.conf;
    }
}

# Optional monitoring
# Enable if you want to monitor Nginx status
#location /nginx_status {
#    stub_status on;
#    access_log off;
#    allow 127.0.0.1;
#    allow 100.64.0.0/10;  # Tailscale network
#    deny all;
#}